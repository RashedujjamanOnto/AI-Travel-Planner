<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Travel Planner üåç</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
/* --- STYLES --- */
body {
    font-family: 'Inter', sans-serif;
    background: linear-gradient(135deg,#e0f7fa,#ffffff);
    margin:0; padding:0;
    color:#333;
}
.container {
    max-width:1000px;
    margin:3rem auto;
    padding:10px 15px 10px 50px;
    background:#fff;
    border-radius:25px;
    box-shadow:0 25px 50px rgba(0,0,0,0.1);
}
h1{
    text-align:center;
    color:#00695c;
    font-size:2.6rem;
    margin-bottom:0.3rem;
}
/* FORM STYLES - Improved Spacing */
.form-group {
    display:flex;
    flex-wrap:wrap;
    gap: 0.8rem 1.5rem; 
    margin-bottom:1.2rem;
    justify-content: space-between; 
}
.form-field {
    flex: 1 1 45%; 
    display: flex;
    flex-direction: column;
}
.form-field.full-width {
    flex: 1 1 100%;
}
.form-field label{
    font-size:0.95rem;
    margin-bottom:10px; 
    color:#555;
    font-weight: 600;
}
input[type="text"], input[type="number"], input[type="password"] {
    padding:0.9rem 1rem;
    border-radius:10px;
    border:1px solid #ccc;
    font-size:1rem;
    width: 80%;
}
input[type="text"], input[type="number"] {
    width: 80%;
}
input[type="password"] {
    width: 90%;
}
.icon-input {
    position: relative;
    display: flex;
    align-items: center;
}
.icon-input i {
    position: absolute;
    left: 15px;
    color: #00bfa5;
}
.icon-input input {
    padding-left: 40px; 
}
.checkbox-group {
    display: flex;
    gap: 20px;
}
button{
    padding:1rem 2rem;
    font-size:1.1rem;
    background: linear-gradient(90deg,#00bfa5,#00695c);
    color:#fff;
    border:none;
    border-radius:10px;
    cursor:pointer;
    flex:1 1 100%;
    font-weight:600;
    box-shadow:0 8px 20px rgba(0,191,165,0.3);
    margin-top: 10px;
    margin-right: 38px;
}
/* OUTPUT STYLES - Improved Spacing and Clutter */
.output-section {
    margin-top: 3rem;
}
.card {
    background: #ffffff;
    padding:2rem 2rem; 
    margin-bottom:2.5rem; 
    border-left:6px solid #00bfa5;
    border-radius:10px;
    box-shadow:0 10px 25px rgba(0,0,0,0.08);
    margin-right: 38px;
}
.card h2 {
    color:#00695c;
    margin-bottom:1rem;
    font-size:1.8rem;
    border-bottom: 2px solid #00bfa550;
    padding-bottom: 10px;
}
.card h3 {
    color:#00796b;
    margin-top: 1.5rem; 
    margin-bottom:0.8rem;
    font-size:1.3rem;
}
.itinerary-day {
    margin-top: 2rem; 
    padding: 1.5rem;
    border: 1px solid #eee;
    border-radius: 8px;
}
.time-slot {
    margin-bottom: 1.5rem; 
    border-left: 4px solid #00bfa5;
    padding-left: 15px;
}
.transport-info {
    background-color: #f0fff0;
    padding: 10px;
    border-radius: 6px;
    margin-top: 8px;
    font-size: 0.9rem;
    border: 1px dashed #00bfa5;
}
.cost-breakdown li {
    list-style-type: none;
    padding-left: 10px;
    border-left: 3px solid #00bfa5;
    margin-bottom: 0.5rem;
}
#pdfDownloadBtn {
    background: linear-gradient(90deg, #d32f2f, #b71c1c); 
    margin-top: 20px;
    box-shadow:0 8px 20px rgba(211,47,47,0.3);
}
#loading {
    display: none;
    text-align: center;
    font-weight: bold;
    color: #f57c00;
    margin-top: 1rem;
    margin-bottom: 16px;
    font-size: 1.2rem;
}
/* Utility class for PDF: hides elements in PDF output */
.hide-in-pdf {
    display: none;
}
</style>
</head>
<body>
<div class="container">
<h1><i class="fas fa-route"></i> AI Travel Planner üåç</h1>
<p style="text-align: center;margin-bottom: 30px;">Plan your perfect trip based on your preferences.</p>

<div class="form-group" style="display:none">
    <div class="form-field full-width">
        <label for="apiKey"><i class="fas fa-key"></i> Google Gen AI API Key</label>
        <div class="icon-input">
            <i class="fas fa-lock"></i>
            <input type="password" id="apiKey" value="AIzaSyBZyjVSZ5sPbtwxvs5id5-exqZxDohaK5Q" placeholder="Enter your AIzaSy... key">
        </div>
    </div>
</div>

<div class="form-group">
    <div class="form-field">
        <label for="from"><i class="fas fa-map-marker-alt"></i> Starting Location</label>
        <div class="icon-input">
            <i class="fas fa-arrow-right"></i>
            <input type="text" id="from" placeholder="e.g., Dhaka">
        </div>
    </div>
    <div class="form-field">
        <label for="to"><i class="fas fa-plane-departure"></i> Destination</label>
        <div class="icon-input">
            <i class="fas fa-map-pin"></i>
            <input type="text" id="to" placeholder="e.g., Cox's Bazar">
        </div>
    </div>
</div>

<div class="form-group">
    <div class="form-field">
        <label for="travelers"><i class="fas fa-users"></i> Number of Travelers</label>
        <div class="icon-input">
            <i class="fas fa-user-friends"></i>
            <input type="number" id="travelers" min="1" max="20" value="1">
        </div>
    </div>
    <div class="form-field">
        <label for="days"><i class="fas fa-calendar-alt"></i> Number of Days</label>
        <div class="icon-input">
            <i class="fas fa-calendar-day"></i>
            <input type="number" id="days" min="1" max="30" value="2">
        </div>
    </div>
</div>

<div class="form-group">
    <div class="form-field">
        <label for="budget"><i class="fas fa-money-bill-wave"></i> Budget (BDT)</label>
        <div class="icon-input">
            <i class="fas fa-money-bill"></i>
            <input type="text" id="budget" placeholder="e.g., 50,000 BDT / Mid-range">
        </div>
    </div>
    <div class="form-field">
        <label for="preferences"><i class="fas fa-heart"></i> Preferences</label>
        <div class="icon-input">
            <i class="fas fa-tags"></i>
            <input type="text" id="preferences" placeholder="adventure, cultural, relaxing">
        </div>
    </div>
</div>

<div class="form-group full-width">
    <div class="form-field full-width">
        <label><i class="fas fa-leaf"></i> Options</label>
        <div class="checkbox-group">
            <label><input type="checkbox" id="eco"> Eco-friendly / Sustainability Focus</label>
            <label><input type="checkbox" id="family"> Family-friendly</label>
        </div>
    </div>
</div>

<div class="form-group">
    <div class="form-field">
        <label for="meal"><i class="fas fa-utensils"></i> Meal Preference</label>
        <div class="icon-input">
            <i class="fas fa-drumstick-bite"></i>
            <input type="text" id="meal" placeholder="vegetarian / non-veg / mixed">
        </div>
    </div>
    <div class="form-field">
        <label for="special"><i class="fas fa-bell"></i> Special Requests</label>
        <div class="icon-input">
            <i class="fas fa-info-circle"></i>
            <input type="text" id="special" placeholder="Optional requests (e.g., wheelchair access)">
        </div>
    </div>
</div>

<div class="form-group">
¬† <button id="generateBtn"><i class="fas fa-magic"></i> Generate Trip Plan</button>
</div>

<div id="loading">Generating your detailed itinerary please wait...</div>
<div id="output"></div>
</div>


<script>
const generateBtn=document.getElementById('generateBtn');
const output=document.getElementById('output');
const loading=document.getElementById('loading');


/* ---------------------------------
   1. AI GENERATOR FUNCTION (STRICT JSON PROMPT)
   --------------------------------- */
async function generateTrip(){
    const key=document.getElementById('apiKey').value.trim();
    const from=document.getElementById('from').value;
    const to=document.getElementById('to').value;
    const travelers=document.getElementById('travelers').value;
    const days=document.getElementById('days').value;
    const budget=document.getElementById('budget').value;
    const preferences=document.getElementById('preferences').value;
    const eco=document.getElementById('eco').checked;
    const family=document.getElementById('family').checked;
    const meal=document.getElementById('meal').value;
    const special=document.getElementById('special').value;

    if(!key){alert('Please provide your Google Gen AI API Key!'); return;}
    if(!from || !to || !travelers || !days){alert('Please fill in Starting Location, Destination, Travelers, and Days.'); return;}

    // Show loading text only after the button is clicked and validation passes
    loading.style.display='block'; 
    output.innerHTML='';

    // *** The final, strong prompt for BDT and valid links ***
    const prompt=`You are an AI travel planner. Plan a trip from ${from} to ${to} for ${travelers} travelers for ${days} days. Preferences: ${preferences}. Budget: ${budget}. Eco-friendly: ${eco}. Family-friendly: ${family}. Meal: ${meal}. Special requests: ${special}.

    Generate the travel plan STRICTLY as a single JSON object. DO NOT include any text, markdown backticks (\`\`\`json), or other information outside of the JSON object.

    All cost fields MUST be represented in BDT (Bangladeshi Taka).

    The JSON object MUST contain the following 7 top-level keys:
    1. "trip_name" (string)
    2. "duration" (string, e.g., "5 days")
    3. "weather_forecast" (string, e.g., "Sunny, 25-30¬∞C for the duration of the trip").
    4. "estimated_total_cost" (object with 'summary' string and 'details' object: {'Hotel': '...', 'Food': '...', 'Transport': '...', 'Sightseeing': '...'}).
    5. "hotel_suggestions" (array of 3 objects, each having: name, location, rating (e.g., 4.5/5), price_range (in BDT), booking_link (MUST be a direct, working URL)).
    6. "meal_suggestions" (array of 3 objects, each having: name, type, budget (in BDT), google_maps_link (MUST be a direct, working URL)).
    7. "itinerary" (object where keys are "day_1", "day_2", etc. Each day must have 'morning', 'afternoon', 'evening' time slots).
    
    Each time slot inside the "itinerary" must be an object containing:
    A. "activity" (string, the main place or event).
    B. "google_maps_link" (string, **MUST be a valid and direct Google Maps URL, NOT a placeholder**. The format **must** look like **"https://www.google.com/maps..."** or **".../1..."**. **STRICTLY AVOID** any links ending with \`/0\` or that are non-functional.).
    C. "entry_fee" (string, e.g., "500 BDT" or "Free").
    D. "timing" (string, e.g., "9:00 AM - 5:00 PM").
    E. "transport" (object with: "type" (e.g., Bus, Taxi), "name" (e.g., Bus 300), "pickup_point" (string, e.g., "Dhaka Gabtoli Bus Terminal"), and "cost" (string, in BDT)).
    
    Start your response directly with the opening curly brace '{' of the JSON object.`;


    try{
        const response=await fetch(
            'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent',
            {
                method:'POST',
                headers:{
                    'Content-Type':'application/json',
                    'X-Goog-Api-Key': key 
                },
                body:JSON.stringify({
                    model:"gemini-2.5-flash",
                    contents:[{role:"user", parts: [{text: prompt}]}],
                })
            }
        );

        const data=await response.json();
        let text="";
        
        if(data && data.candidates && data.candidates.length > 0 && data.candidates[0].content.parts.length > 0){
            text=data.candidates[0].content.parts[0].text;
        } else {
            const errorMsg = data.error ? data.error.message : "AI response not received properly. Check your API Key or input data.";
            output.innerHTML=`<div class="card"><p style="color:red">Error: ${errorMsg}</p></div>`;
            loading.style.display='none';
            return;
        }

        let trip;
        try{ 
            // Attempt to parse the pure JSON output
            trip = JSON.parse(text); 
        }¬†
        catch(e){ 
            console.error("JSON Parse Error:", e, "\nRaw Text:", text);
            output.innerHTML=`<div class="card"><p style="color:red">JSON Parse Error. The AI might have included extra text. Please try again or check console for raw output.</p></div>`;
            loading.style.display='none';
            return; 
        }
        
        displayTrip(trip); 

    } catch(err){ 
        output.innerHTML=`<div class="card"><p style="color:red">Connection Error: ${err.message}</p></div>`; 
    }
    finally{ loading.style.display='none'; }
}

/* ---------------------------------
   2. DISPLAY FUNCTION (STEP-BY-STEP OUTPUT)
   --------------------------------- */
function displayTrip(parsedTripData) {
    // Add ID for PDF export
    output.innerHTML = '<div class="output-section" id="itineraryContent"></div>'; 
    const outputSection = output.querySelector('.output-section');

    // --- STEP 1: SUMMARY CARD ---
    const summaryCard = document.createElement('div');
    summaryCard.className = 'card';
    summaryCard.innerHTML = `
        <h2><i class="fas fa-clipboard-list"></i> Trip Overview: ${parsedTripData.trip_name || 'AI Generated Trip'}</h2>
        <p style="text-align:left; margin-bottom: 0.5rem;"><strong>Destination:</strong> ${document.getElementById('to').value || 'N/A'}</p>
        <p style="text-align:left; margin-bottom: 0.5rem;"><strong>Duration:</strong> ${parsedTripData.duration || 'N/A'}</p>
        <p style="text-align:left; margin-bottom: 0.5rem;"><strong><i class="fas fa-sun"></i> Weather Forecast:</strong> ${parsedTripData.weather_forecast || 'N/A'}</p>
    `;
    outputSection.appendChild(summaryCard);

    // --- STEP 2: COST BREAKDOWN ---
    const costCard = document.createElement('div');
    costCard.className = 'card cost-breakdown';
    costCard.innerHTML = `
        <h3><i class="fas fa-hand-holding-usd"></i> Estimated Total Cost ‡ß≥</h3>
        <p style="text-align:left; font-weight:600;">Summary: ${parsedTripData.estimated_total_cost?.summary || 'N/A'}</p>
        <ul style="text-align:left;">
            ${Object.entries(parsedTripData.estimated_total_cost?.details || {}).map(([k,v]) => `<li><strong>${k}:</strong> ${v}</li>`).join('')}
        </ul>
    `;
    outputSection.appendChild(costCard);

    // --- STEP 3: DAY-WISE ITINERARY ---
    const itineraryCard = document.createElement('div');
    itineraryCard.className = 'card';
    itineraryCard.innerHTML = `<h2><i class="fas fa-map-marked-alt"></i> Detailed Itinerary</h2>`;

    Object.keys(parsedTripData.itinerary).forEach(dayKey => {
        const day = parsedTripData.itinerary[dayKey];
        const dayContent = document.createElement('div');
        dayContent.className = 'itinerary-day';
        dayContent.innerHTML = `<h3 style="margin-top:0;"><i class="fas fa-calendar-day"></i> ${dayKey.replace('_',' ').toUpperCase()}</h3>`;

        ['morning','afternoon','evening'].forEach(time => {
            if(day[time]){
                const slot = day[time];
                const transport = slot.transport || {};
                
                dayContent.innerHTML += `
                    <div class="time-slot">
                        <p><strong><i class="fas fa-clock"></i> ${time.charAt(0).toUpperCase() + time.slice(1)}:</strong></p>
                        <p style="margin-top:0;">
                            <strong><i class="fas fa-walking"></i> Activity:</strong> ${slot.activity || 'N/A'}<br>
                            <strong>Details:</strong> Fee: ${slot.entry_fee || 'N/A'} | Timing: ${slot.timing || 'N/A'}<br>
                            
                            ${slot.meal ? `<strong><i class="fas fa-utensils"></i> Meal:</strong> ${slot.meal}<br>` : ''}
                            
                            ${slot.google_maps_link ? `<span class="map-link-text hide-in-pdf">Map Link (Copy/Paste for PDF): ${slot.google_maps_link}</span><br>` : ''}
                            ${slot.google_maps_link ? `<a href="${slot.google_maps_link}" target="_blank">View on Google Maps üó∫Ô∏è</a>` : ''}
                        </p>
                        <div class="transport-info">
                            <strong><i class="fas fa-bus"></i> Transport:</strong> ${transport.type || 'N/A'} (${transport.name || 'Generic'})<br>
                            <strong>Pickup Point:</strong> ${transport.pickup_point || 'N/A'} | 
                            <strong>Cost:</strong> ${transport.cost || 'N/A'}
                        </div>
                    </div>
                `;
            }
        });
        itineraryCard.appendChild(dayContent);
    });
    outputSection.appendChild(itineraryCard);
    
    // --- STEP 4: SUGGESTIONS ---
    const suggestionsCard = document.createElement('div');
    suggestionsCard.className = 'card suggestion-list';
    suggestionsCard.innerHTML = `<h2><i class="fas fa-lightbulb"></i> Recommendations</h2>`;

    // Hotels
    if(parsedTripData.hotel_suggestions && parsedTripData.hotel_suggestions.length > 0){
        suggestionsCard.innerHTML += `<h3>üè® Hotel Recommendations</h3><ul>` +
            parsedTripData.hotel_suggestions.map(h => {
                return `<li style="text-align:left;">
                    <strong>${h.name || 'N/A'}</strong> (${h.location || 'N/A'})<br>
                    <strong><i class="fas fa-star"></i> Rating:</strong> ${h.rating || 'N/A'} | <strong><i class="fas fa-tags"></i> Price:</strong> ${h.price_range || 'N/A'}<br>
                    <span class="booking-link-text hide-in-pdf">Booking Link (Copy/Paste for PDF): ${h.booking_link || 'N/A'}</span><br>
                    <p style="margin-bottom:15px"><a href="${h.booking_link || '#'}" target="_blank">Check Booking Link üîó</a>></p>
                </li>`;
            }).join('') + `</ul>`;
    }

    // Meals
    if(parsedTripData.meal_suggestions && parsedTripData.meal_suggestions.length > 0){
        suggestionsCard.innerHTML += `<h3>üçΩÔ∏è Restaurant Suggestions</h3><ul>` +
            parsedTripData.meal_suggestions.map(m=>{
                return `<li style="text-align:left;">
                    <strong>${m.name || 'N/A'}</strong> (${m.type || 'N/A'})<br>
                    <strong>Budget:</strong> ${m.budget || 'N/A'} | 
                    <span class="map-link-text hide-in-pdf">Map Link (Copy/Paste for PDF): ${m.google_maps_link || 'N/A'}</span><br>
                    <a href="${m.google_maps_link || '#'}" target="_blank">Map üó∫Ô∏è</a>
                </li>`;
            }).join('') + `</ul>`;
    }
    outputSection.appendChild(suggestionsCard);

    // // --- STEP 5: PDF DOWNLOAD AND EXTRA TOOLS ---
    // const extraCard = document.createElement('div');
    // extraCard.className = 'card';
    // extraCard.innerHTML = `
    //     <h2><i class="fas fa-tools"></i> Tools & Export</h2>
        
    //     <h3>üå± Sustainability Tips</h3>
    //     <ul style="list-style-type: disc; padding-left: 20px;">
    //         ${parsedTripData.sustainability_tips?.map(t=>`<li>${t}</li>`).join('') || '<li>No specific tips provided.</li>'}
    //     </ul>
        
    //     <h3 style="margin-top: 1.5rem;">‚¨áÔ∏è Export & Map</h3>
    //     <div class="form-group" style="margin-top: 15px;">
    //         <button id="pdfDownloadBtn" onclick="downloadPDF('Trip Plan')"><i class="fas fa-file-pdf"></i> Download Plan as PDF</button>
    //         <button onclick="alert('Interactive Map View requires an external mapping API.')" style="flex:auto; background: #607d8b; margin-top: 0;"><i class="fas fa-map"></i> Interactive Map View</button>
    //     </div>
    // `;
    //outputSection.appendChild(extraCard);
}

generateBtn.addEventListener('click',generateTrip);


/* ---------------------------------
   3. PDF DOWNLOAD FUNCTION (using html2pdf.js)
   --------------------------------- */
function downloadPDF() {
    const content = document.getElementById('itineraryContent');
    if (!content) {
        alert("No itinerary generated yet!");
        return;
    }

    // 1. Create a deep clone to manipulate content for PDF without changing the display
    const tempElement = content.cloneNode(true);
    
    // 2. Adjust styling within the clone for better PDF appearance (e.g., remove live links and buttons)
    
    // Remove the interactive buttons
    tempElement.querySelectorAll('.form-group button, #pdfDownloadBtn').forEach(el => el.style.display = 'none');
    
    // Hide the live links and ONLY show the plain text links (which were previously marked with hide-in-pdf class)
    tempElement.querySelectorAll('a[target="_blank"]').forEach(el => el.remove());
    tempElement.querySelectorAll('.hide-in-pdf').forEach(el => el.style.display = 'block');
    
    // Simplify the look of itinerary sections for printing
    tempElement.querySelectorAll('.itinerary-day, .transport-info').forEach(el => {
        el.style.pageBreakInside = 'avoid'; // Prevent element from splitting across pages
        el.style.padding = '10px';
        el.style.margin = '10px 0';
        if (el.classList.contains('transport-info')) {
            el.style.backgroundColor = '#f8f8f8'; // Light background for visibility
            el.style.border = '1px solid #ccc';
        }
    });
    tempElement.querySelectorAll('.card').forEach(el => el.style.pageBreakInside = 'avoid');

    // 3. Configuration for html2pdf
    const options = {
        margin: 10,
        filename: `Travel_Plan.pdf`,
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { 
            scale: 2,           // High scale for better image quality 
            useCORS: true,      // Handle external resources better
            logging: false 
        }, 
        jsPDF: { 
            unit: 'mm', 
            format: 'a4', 
            orientation: 'portrait' 
        }
    };

    // 4. Generate PDF using html2pdf
    html2pdf().set(options).from(tempElement).save();
}
</script>
</body>
</html>


